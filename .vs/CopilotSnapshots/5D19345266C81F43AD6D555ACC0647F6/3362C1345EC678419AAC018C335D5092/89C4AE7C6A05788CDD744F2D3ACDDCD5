param location string = resourceGroup().location
param appName string = 'meeting-breakout-app'
param planName string = 'meeting-breakout-plan'
param storageName string = 'meetingbreakoutstore${uniqueString(resourceGroup().id)}'
param sku string = 'F1' // Free tier for dev

resource storageAccount 'Microsoft.Storage/storageAccounts@2021-09-01' = {
  name: storageName
  location: location
  sku: {
    name: 'Standard_LRS'
  }
  kind: 'StorageV2'
}

resource appServicePlan 'Microsoft.Web/serverfarms@2021-03-01' = {
  name: planName
  location: location
  properties: {
    reserved: true // Linux
  }
  sku: {
    name: sku
  }
  kind: 'linux'
}

resource webApp 'Microsoft.Web/sites@2021-03-01' = {
  name: appName
  location: location
  properties: {
    serverFarmId: appServicePlan.id
    siteConfig: {
      linuxFxVersion: 'DOTNETCORE|8.0'
      appSettings: [
        {
          name: 'AzureAd__TenantId'
          value: '<Your-Tenant-Id>'
        }
        {
          name: 'AzureAd__ClientId'
          value: '<Your-Client-Id>'
        }
        {
          name: 'AzureAd__ClientSecret'
          value: '<Your-Client-Secret>'
        }
        {
          name: 'SharePoint__SiteId'
          value: '<Your-SharePoint-Site-Id>'
        }
        {
          name: 'SharePoint__ListId'
          value: '<Your-SharePoint-List-Id>'
        }
        {
            name: 'SCM_DO_BUILD_DURING_DEPLOYMENT'
            value: 'true'
        }
      ]
    }
  }
}

output webAppName string = webApp.name
output webAppHostName string = webApp.properties.defaultHostName
